#!/bin/bash

DIR="$( cd  "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
ROOT=$( cd $DIR/../ && pwd )

if [[ "$1" == "clean" ]]; then
  rm -rf $ROOT/build
  shift;
fi

mkdir -p $ROOT/build && cd $ROOT/build;

if [[ ! -f $ROOT/build/Makefile ]]; then
  cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DCMAKE_BUILD_TYPE=Debug ..
  if [ ! $? -eq 0 ]; then
    exit 1
  fi
fi

clear

make -j4

if [ ! $? -eq 0 ]; then
  exit 1
fi

make test

if [[ "$1" != "" ]]; then
  echo "Running test: $1"
  echo
  $ROOT/build/tests/$1
fi

